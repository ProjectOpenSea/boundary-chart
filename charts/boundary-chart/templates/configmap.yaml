apiVersion: v1
kind: ConfigMap
metadata:
  name: boundary-config
  labels:
    {{- include "boundary-chart.labels" . | nindent 4 }}
  {{- with .Values.serviceAccount.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
data:
  boundary-config-admin.hcl: |
    disable_mlock = true
    log_format    = "standard"
    controller {
      name        = "kubernetes-controller"
      description = "Boundary controller"
      database {
        url = "postgresql://{{ .Values.database.url }}/{{.Values.database.dbName}}{{- if ne .Values.database.ssl true }}?sslmode=disable{{- end }}"
      }
      public_cluster_addr = "localhost"
    }
    worker {
      name        = "kubernetes-worker"
      description = "Boundary worker"
      address     = "localhost"
      controllers = ["localhost"]
      public_addr = "{{ .Values.publicAddress }}:{{ .Values.publicPort }}"
    }
    listener "tcp" {
      address     = "0.0.0.0"
      purpose     = "api"
      tls_disable = true
    }
    listener "tcp" {
      address     = "0.0.0.0"
      purpose     = "cluster"
      tls_disable = true
    }
    listener "tcp" {
      address     = "0.0.0.0"
      purpose     = "proxy"
      tls_disable = true
    }
    kms "awskms" {
      purpose    = "root"
      kms_key_id = {{ .Values.kms.keyId | quote }}
    }
    kms "awskms" {
      purpose    = "recovery"
      kms_key_id = {{ .Values.kms.keyId | quote }}
    }
    kms "awskms" {
      purpose    = "worker-auth"
      kms_key_id = {{ .Values.kms.keyId | quote }}
    }
    kms "awskms" {
      purpose    = "config"
      kms_key_id = {{ .Values.kms.keyId | quote }}
    }
  boundary-config.hcl: |
    disable_mlock = true
    log_format    = "standard"
    controller {
      name        = "kubernetes-controller"
      description = "Boundary controller"
      database {
        url = "postgresql://{{ .Values.database.url }}/{{.Values.database.dbName}}{{- if ne .Values.database.ssl true }}?sslmode=disable{{- end }}"
      }
      public_cluster_addr = "localhost"
    }
    worker {
      name        = "kubernetes-worker"
      description = "Boundary worker"
      address     = "localhost"
      controllers = ["localhost"]
      public_addr = "{{ .Values.publicAddress }}:{{ .Values.publicPort }}"
    }
    listener "tcp" {
      address     = "0.0.0.0"
      purpose     = "api"
      tls_disable = true
    }
    listener "tcp" {
      address     = "0.0.0.0"
      purpose     = "cluster"
      tls_disable = true
    }
    listener "tcp" {
      address     = "0.0.0.0"
      purpose     = "proxy"
      tls_disable = true
    }
    kms "awskms" {
      purpose    = "root"
      kms_key_id = {{ .Values.kms.keyId | quote }}
    }
    kms "awskms" {
      purpose    = "recovery"
      kms_key_id = {{ .Values.kms.keyId | quote }}
    }
    kms "awskms" {
      purpose    = "worker-auth"
      kms_key_id = {{ .Values.kms.keyId | quote }}
    }
    kms "awskms" {
      purpose    = "config"
      kms_key_id = {{ .Values.kms.keyId | quote }}
    }
